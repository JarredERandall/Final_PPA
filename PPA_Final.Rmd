---
title: "Fairbnb"
output: html_document
date: "2023-12-01"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r setup, include=FALSE, class.source = 'fold-show'}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(tidycensus)
library(sf)
library(stargazer)
library(spdep)
library(caret)
library(ckanr)
library(FNN)
library(kableExtra)
library(grid)
library(viridisLite)
library(viridis)
library(gridExtra)
library(jtools)
library(ggcorrplot) 
library(corrr)      
library(kableExtra)
library(jtools)     
library(ggstance) 
library(ggpubr)   
library(broom.mixed) 
options(scipen = 999)


root.dir = "https://raw.githubusercontent.com/urbanSpatial/Public-Policy-Analytics-Landing/master/DATA/"

source("https://raw.githubusercontent.com/urbanSpatial/Public-Policy-Analytics-Landing/master/functions.r")

census_api_key("a6d692af505769f28e39a3ac16b7dcbacb1dad58", overwrite = TRUE)

palette5 <- c("#25CB10", "#5AB60C", "#8FA108",   "#C48C04", "#FA7800")

palette6 <- c("#25CB10", "#5AB60C", "grey40",   "grey40", "#FA7800")

theme_update(plot.title = element_text(hjust = 0.5))



```

# Intro

# Data

```{r read_data, results = FALSE, message = FALSE, warning = FALSE, error = FALSE}
#JArred
listings <- read.csv("C:\\Users\\fatbo\\OneDrive\\Desktop\\Airbnb\\Airbnb\\listings.csv")

listings_details <- read.csv("C:\\Users\\fatbo\\OneDrive\\Desktop\\Airbnb\\Airbnb\\listings_details.csv")

nhoods <- st_read("C:\\Users\\fatbo\\OneDrive\\Desktop\\Airbnb\\Airbnb\\neighbourhoods.geojson")

joined <- left_join(listings, listings_details, by = "id", suffix=c("", ".y")) %>% select(-ends_with(".y"))



```

join nhood to joined

```{r read_data, results = FALSE, message = FALSE, warning = FALSE, error = FALSE}
#Nohman
listings <- read.csv("/Users/nohman/Documents/GitHub/PPA_Final_Airbnb/Data/Airbnb/listings.csv")

listings_details <- read.csv("/Users/nohman/Documents/GitHub/PPA_Final_Airbnb/Data/Airbnb/listings_details.csv")

nhoods <- st_read("/Users/nohman/Documents/GitHub/PPA_Final_Airbnb/Data/Airbnb/neighbourhoods.geojson")

joined <- left_join(listings, listings_details, by = "id", suffix=c("", ".y")) %>% select(-ends_with(".y"))

unique_nhoods <- as.data.frame(unique(joined$neighbourhood_cleansed))
View(unique_nhoods)





```


```{r read_data, results = FALSE, message = FALSE, warning = FALSE, error = FALSE}
#JArred
listings <- read.csv("C:\\Users\\fatbo\\OneDrive\\Desktop\\Airbnb\\Airbnb\\listings.csv")

listings_details <- read.csv("C:\\Users\\fatbo\\OneDrive\\Desktop\\Airbnb\\Airbnb\\listings_details.csv")

nhoods <- st_read("C:\\Users\\fatbo\\OneDrive\\Desktop\\Airbnb\\Airbnb\\neighbourhoods.geojson")

joined <- left_join(listings, listings_details, by = "id", suffix=c("", ".y")) %>% select(-ends_with(".y"))

```

join nhood to joined



``` {r joined_nhood sf}

joined_sf <- st_as_sf(joined, coords = c('longitude', 'latitude'), crs = 4326)  %>%
  st_transform(st_crs(nhoods))
  

joined_nhood <- st_join(joined_sf, nhoods, join = st_within)

st_crs(nhoods)
```


View(nhoods)
- Add sentiment analysis 
- Add tract info


# OLS Regression Model

```{r read_data, results = FALSE, message = FALSE, warning = FALSE, error = FALSE}
# Checking if we have too many categories in a variable
roomtype <- unique(joined$room_type)
length(roomtype)

property_type <- unique(joined$property_type)
length(property_type)

sum(is.na(joined$square_feet))

joined <- joined %>% mutate(extra_people_is_cost = ifelse(joined$extra_people %in% c("$0.00"), "No", "Yes"))
View(joined)
```
Regression Variables:

Spatial Features:
-nhood
-k nearest neighboors price per sqft

Non-Spatial (hedonic) Features:
- room type
- number of reviews
- availability
- is super host
- identity verified
- property type
- accomodates / guests_included?
- bathrooms
- bedrooms
- break up the amenities
- sqft is not there for all
- review_scores_rating
- costs extra?
- is real bed?

medhh income
pct education
pct immigrants
marital status
year built
Profession



Check instances for each variable



Questions for Michael:
1. Wants to see process of varibale choice (i.e. we run regression and then drop variables etc?)
2. Is our idea valid?







